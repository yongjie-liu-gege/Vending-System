<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Vending Anywhere</title>
    <link rel="stylesheet" href="/vending-system/styles.css">
    <!-- 引入 ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    <!-- 顶部导航栏 -->
    <header class="top-header">
        <div class="logo">
            <img src="path/to/logo.png" alt="Smart Vending Anywhere">
            <span>Smart Vending Anywhere</span>
        </div>
        <div class="header-right">
            <span class="time">2024-12-28 星期四</span>
            <span class="user">星期六</span>
            <div class="header-icons">
                <a href="#" class="icon-item">数据看板</a>
                <a href="#" class="icon-item">帮助</a>
                <a href="#" class="icon-item">设置</a>
                <a href="#" class="icon-item">退出</a>
            </div>
        </div>
    </header>

    <div class="main-container">
        <!-- 左侧菜单 -->
        <nav class="side-menu">
            <div class="menu-header">
                <i class="fas fa-chart-bar"></i>
                <span>SVA 报表输出</span>
            </div>
            <ul class="menu-list">
                <li>
                    <details>
                        <summary>
                            <i class="fas fa-tasks"></i>
                            日常业务
                        </summary>
                        <ul>
                            <li><a href="#" id="databoardLink"><i class="fas fa-chart-line"></i> 数据看板</a></li>
                            <li><a href="#"><i class="fas fa-users"></i> 用户管理</a></li>
                            <li><a href="#"><i class="fas fa-tachometer-alt"></i> 计量点管理</a></li>
                            <li><a href="#"><i class="fas fa-bolt"></i> 追补电量</a></li>
                            <li><a href="#"><i class="fas fa-plug"></i> 售电</a></li>
                            <li><a href="#"><i class="fas fa-key"></i> STS测试Token</a></li>
                            <li><a href="#"><i class="fas fa-shield-alt"></i> 维护Token</a></li>
                            <li><a href="#"><i class="fas fa-lock"></i> 更改密钥Token</a></li>
                            <li><a href="#"><i class="fas fa-dollar-sign"></i> 费率修改</a></li>
                            <li><a href="#"><i class="fas fa-gift"></i> 免费充值代码</a></li>
                        </ul>
                    </details>
                </li>
                <li><a href="#"><i class="fas fa-store"></i> 售电站</a></li>
                <li><a href="#"><i class="fas fa-money-bill-wave"></i> 分账支付管理</a></li>
                <li><a href="#"><i class="fas fa-file-invoice-dollar"></i> 财务管理</a></li>
                <li><a href="#"><i class="fas fa-user-tie"></i> 代理商管理</a></li>
                <li><a href="#"><i class="fas fa-warehouse"></i> 农计库存管理</a></li>
                <li><a href="#"><i class="fas fa-network-wired"></i> HES接口管理</a></li>
                <li><a href="#"><i class="fas fa-shield-alt"></i> 安全模块</a></li>
                <li><a href="#"><i class="fas fa-info-circle"></i> 基本信息</a></li>
                <li><a href="#"><i class="fas fa-cog"></i> 系统信息</a></li>
            </ul>
        </nav>

        <!-- 主要内容区域 -->
        <main class="content">
            <!-- 添加视频容器，默认隐藏 -->
            <div id="videoSection" style="display: none;">
                <div class="video-container">
                    <video id="localVideo" controls width="100%">
                        <source src="/vending-system/videos/1.mp4" type="video/mp4">
                        您的浏览器不支持 HTML5 视频播放
                    </video>
                </div>
            </div>

            <!-- 原有的数据概览部分，默认显示 -->
            <div id="dataOverview">
                <div class="page-header">
                    <h2>数据概览</h2>
                    <span class="sub-title">E2C 等级</span>
                </div>

                <!-- 今日统计数据 -->
                <div class="stats-cards">
                    <div class="stat-card">
                        <h3>交易<i class="info-icon"></i></h3>
                        <div class="stat-value">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>销售额<i class="info-icon"></i></h3>
                        <div class="stat-value">0.00<span>FCFA</span></div>
                    </div>
                    <div class="stat-card">
                        <h3>电量<i class="info-icon"></i></h3>
                        <div class="stat-value">0.0<span>kW·h</span></div>
                    </div>
                    <div class="stat-card">
                        <h3>欠款金额<i class="info-icon"></i></h3>
                        <div class="stat-value">0.00<span>FCFA</span></div>
                    </div>
                </div>

                <!-- 图表区域 -->
                <div class="charts-container">
                    <div class="chart-tabs">
                        <button class="tab-btn active">年</button>
                        <button class="tab-btn">季</button>
                        <button class="tab-btn">月</button>
                    </div>
                    <div class="charts-grid">
                        <div class="chart-item" id="salesChart"></div>
                        <div class="chart-item" id="powerChart"></div>
                        <div class="chart-item" id="debtChart"></div>
                    </div>
                </div>

                <!-- 详细数据图表 -->
                <div class="detail-charts">
                    <div class="chart-box">
                        <h3>售电数量<i class="info-icon"></i></h3>
                        <div id="powerDetailChart"></div>
                    </div>
                    <div class="chart-box">
                        <h3>月购电指数<i class="info-icon"></i></h3>
                        <div id="monthlyIndexChart"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
    // 更新当日数据
    document.addEventListener('DOMContentLoaded', function() {
        // 模拟当日数据
        const todayData = {
            transactions: 156,
            sales: '2,358.00',
            power: '486.5',
            debt: '328.45'
        };

        // 更新统计卡片数据
        document.querySelector('.stat-card:nth-child(1) .stat-value').textContent = todayData.transactions;
        document.querySelector('.stat-card:nth-child(2) .stat-value').textContent = todayData.sales + ' FCFA';
        document.querySelector('.stat-card:nth-child(3) .stat-value').textContent = todayData.power + ' kW·h';
        document.querySelector('.stat-card:nth-child(4) .stat-value').textContent = todayData.debt + ' FCFA';

        // 初始化所有图表
        initializeCharts();
    });

    function initializeCharts() {
        // 销售额与电量关系图表
        const salesPowerChart = echarts.init(document.getElementById('salesChart'));
        const powerChart = echarts.init(document.getElementById('powerChart'));
        const debtChart = echarts.init(document.getElementById('debtChart'));
        const powerDetailChart = echarts.init(document.getElementById('powerDetailChart'));
        const monthlyIndexChart = echarts.init(document.getElementById('monthlyIndexChart'));

        // 年度数据
        const yearOption = {
            title: { text: '年度销售数据' },
            tooltip: { trigger: 'axis' },
            xAxis: {
                type: 'category',
                data: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月']
            },
            yAxis: [
                { type: 'value', name: '电量 (kW·h)' },
                { type: 'value', name: '销售额 (FCFA)' }
            ],
            series: [
                {
                    name: '电量',
                    type: 'bar',
                    data: [320, 280, 350, 410, 390, 380, 420, 450, 400, 380, 360, 405]
                },
                {
                    name: '销售额',
                    type: 'line',
                    yAxisIndex: 1,
                    data: [1500, 1300, 1680, 1890, 1750, 1820, 1960, 2100, 1880, 1790, 1700, 1850]
                }
            ]
        };

        // 售电数量图表
        const powerDetailOption = {
            title: { text: '近30天售电数量' },
            tooltip: { trigger: 'axis' },
            xAxis: {
                type: 'category',
                data: Array.from({length: 30}, (_, i) => `${i + 1}日`)
            },
            yAxis: { type: 'value', name: '交易数量' },
            series: [{
                data: Array.from({length: 30}, () => Math.floor(Math.random() * 100 + 50)),
                type: 'line',
                smooth: true
            }]
        };

        // 月购电指数图表
        const monthlyIndexOption = {
            title: { text: '月购电指数' },
            tooltip: { trigger: 'axis' },
            xAxis: {
                type: 'category',
                data: ['1月', '2月', '3月', '4月', '5月', '6月']
            },
            yAxis: {
                type: 'value',
                name: '购电比例',
                axisLabel: {
                    formatter: '{value}%'
                }
            },
            series: [{
                data: [65, 58, 72, 68, 75, 80],
                type: 'line',
                smooth: true,
                areaStyle: {}
            }]
        };

        // 渲染图表
        salesPowerChart.setOption(yearOption);
        powerChart.setOption(yearOption);
        debtChart.setOption(yearOption);
        powerDetailChart.setOption(powerDetailOption);
        monthlyIndexChart.setOption(monthlyIndexOption);

        // 添加标签切换事件
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                // 移除所有活动状态
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                // 添加当前活动状态
                this.classList.add('active');

                // 根据选择的时间范围更新图表
                const period = this.textContent;
                let newOption = { ...yearOption };
                
                if (period === '月') {
                    newOption.xAxis.data = Array.from({length: 30}, (_, i) => `${i + 1}日`);
                    newOption.series[0].data = Array.from({length: 30}, () => Math.floor(Math.random() * 100 + 200));
                    newOption.series[1].data = Array.from({length: 30}, () => Math.floor(Math.random() * 1000 + 1000));
                } else if (period === '季') {
                    newOption.xAxis.data = ['一季度', '二季度', '三季度', '四季度'];
                    newOption.series[0].data = [350, 420, 380, 390];
                    newOption.series[1].data = [1600, 1900, 1750, 1800];
                }

                salesPowerChart.setOption(newOption);
                powerChart.setOption(newOption);
                debtChart.setOption(newOption);
            });
        });

        // 窗口大小改变时重绘图表
        window.addEventListener('resize', function() {
            salesPowerChart.resize();
            powerChart.resize();
            debtChart.resize();
            powerDetailChart.resize();
            monthlyIndexChart.resize();
        });
    }

    // 修改菜单点击事件处理
    document.addEventListener('DOMContentLoaded', function() {
        // 获取数据看板链接（使用ID选择器更准确）
        const databoardLink = document.getElementById('databoardLink');
        
        if (databoardLink) {
            databoardLink.addEventListener('click', function(e) {
                e.preventDefault();
                console.log('数据看板被点击'); // 调试用
                
                // 切换显示内容
                const videoSection = document.getElementById('videoSection');
                const dataOverview = document.getElementById('dataOverview');
                
                if (videoSection && dataOverview) {
                    videoSection.style.display = 'block';
                    dataOverview.style.display = 'none';
                    
                    // 获取视频元素并播放
                    const video = document.getElementById('localVideo');
                    if (video) {
                        // 修改这里的视频源路径
                        video.src = '/vending-system/videos/1.mp4';  // 使用相对路径
                        
                        // 尝试播放视频
                        video.load();
                        video.play().catch(function(error) {
                            console.log("视频自动播放失败:", error);
                            alert("视频加载失败，请检查文件路径是否正确");
                        });
                    }
                }
            });
        }
    });

    // 添加一个返回按钮，可以从视频页面返回到数据概览
    const videoSection = document.getElementById('videoSection');
    if (videoSection) {
        const backButton = document.createElement('button');
        backButton.textContent = '返回数据概览';
        backButton.className = 'back-button';
        backButton.onclick = function() {
            videoSection.style.display = 'none';
            document.getElementById('dataOverview').style.display = 'block';
        };
        videoSection.insertBefore(backButton, videoSection.firstChild);
    }
    </script>
</body>
</html>
